<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>班级管理</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/style2.css"/>
		<link rel="stylesheet" type="text/css" href="css/layui.css"/>
	</head>
	<body class="gray-bg">
	<div class="container-div">
	    <div class="row" style="padding:0px;">
	        <div class="col-sm-12 search-collapse">
	            <form id="formId">
	                <div class="select-list">
	                    <input id="treeId" name="moduleId" type="hidden" value=""/>
	                    <ul class="list-inline">
	                    	<li>
								班级名称：
	                            <input type="text"  id="clazzName"  value=""/>
	                       </li>
	                        <li>
	                           	班级状态：
	                            <select id="status" name="status" >
	                                <option value="">所有</option>
	                                <option value="0">正常</option>
	                                <option value="1">关闭</option>
	                            </select>
	                        </li>
	                        <li>
	                            <a class="btn btn-primary btn-rounded btn-sm " id="find" data-type="reload">
	                            	<i class="fa fa-search glyphicon glyphicon-search"></i>&nbsp;搜索</a>
	                            <a class="btn btn-warning btn-rounded btn-sm" onclick="resetForm()">
	                            	<i class="fa fa-refresh glyphicon glyphicon-refresh" ></i>&nbsp;重置</a>
	                        </li>
	                    </ul>
	                </div>
	            </form>
	        </div>
	        
	        <div class="col-sm-12 select-table table-striped">
	        	<div class="btn-group-sm hidden-xs" id="toolbar" role="group"  style="margin-top: 14px;">
	                <a class="btn btn-primary add" data-method="offset" data-type="auto">
	                    <i class="fa fa-plus glyphicon glyphicon-plus"></i> 新增
	                </a>
	                 <a class="btn btn-info" data-method="offset" data-type="auto" id="zhankai">
	                    <i class="glyphicon glyphicon-sort"></i> 展开/折叠
	                </a>
					<div class="columns columns-right btn-group pull-right">
		        		<button class="btn btn-default btn-outline" type="button" name="showSearch" title="搜索">
		        			<i class="glyphicon glyphicon-search"></i>
		        		</button>
		        		<button class="btn btn-default btn-outline" type="button" name="refresh" title="刷新">
		        			<i class="glyphicon glyphicon-refresh icon-refresh"></i>
		        		</button>
		        		<button class="btn btn-default btn-outline" type="button" name="toggle" title="切换">
		        			<i class="glyphicon glyphicon-list-alt icon-list-alt"></i>
		        		</button>
	        		</div>
	        	</div>
		        <table class="layui-hide" id="test" lay-filter="demoTreeTb">
		        	
		        </table>
		        
	        </div>
	    </div>
	</div>
				<!--新增框-->
        			<div class="layui-row" id="popCreateTest" style="display: none;">
			    		<div class="layui-col-md10">
			    			<form class="form-horizontal m layui-form"  novalidate="novalidate" lay-filter="example1">
							<div class="form-group">
								<label class="col-sm-3 control-label">所属年级：</label>
								<div class="col-sm-8">
									<select  class="form-control m-b "  id="parentId" name="parentId" lay-verify="required"  class="select">
									    <option value="">---请选择---</option>
					               </select>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">班级名称：</label>
								<div class="col-sm-8">
									<input class="form-control" type="text" name="clazzName" >
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">显示排序：</label>
								<div class="col-sm-8">
									<input class="form-control" type="text" name="orderNum">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">班主任：</label>
								<div class="col-sm-8">
									<input class="form-control" type="text" name="leader">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">联系电话：</label>
								<div class="col-sm-8">
									<input class="form-control" type="text" name="phone">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">邮箱：</label>
								<div class="col-sm-8">
									<input class="form-control" type="text" name="email">
								</div>
							</div>
							<div class="form-group">
										<label class="col-sm-3 control-label">状态：</label>
										<div class="col-sm-8">
											 <input type="radio" name="status" value="0" title="正常" checked="">
	      									<input type="radio" name="status" value="1" title="停用">
										</div>
									</div>
							<div class="layui-form-item">
								    <div class="layui-input-block" style="text-align: center;">
								    	 <button class="layui-btn" lay-submit lay-filter="formDemo2" >新增</button>
								      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
								    </div>
								  	</div>
						</form>		
				    </div>
				</div>   
				<!--修改框-->
				<div class="layui-row" id="popUpdateTest" style="display:none;">
			    		<div class="layui-col-md10">
			    			<form class="form-horizontal m layui-form" id="form-dict-add" novalidate="novalidate" lay-filter="example">
							<input name="clazzId" type="hidden" >
							<input name="clientId" type="hidden" id="clientId">
							<div class="form-group">
								<label class="col-sm-3 control-label">所属年级：</label>
								<div class="col-sm-8">
									<select  class="form-control m-b "  id="parentId2" name="parentId" lay-verify="required"  class="select">
									    <option value="">---请选择---</option>
					               </select>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">班级名称：</label>
								<div class="col-sm-8">
									<input class="form-control" type="text" name="clazzName" >
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">显示排序：</label>
								<div class="col-sm-8">
									<input class="form-control" type="text" name="orderNum">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">班主任：</label>
								<div class="col-sm-8">
									<input class="form-control" type="text" name="leader">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">联系电话：</label>
								<div class="col-sm-8">
									<input class="form-control" type="text" name="phone">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">邮箱：</label>
								<div class="col-sm-8">
									<input class="form-control" type="text" name="email">
								</div>
							</div>
							<div class="form-group">
										<label class="col-sm-3 control-label">状态：</label>
										<div class="col-sm-8">
											 <input type="radio" name="status" value="0" title="正常" checked="">
	      									<input type="radio" name="status" value="1" title="停用">
										</div>
									</div>
							<div class="layui-form-item">
						    <div class="layui-input-block" style="text-align: center;">
						    	 <button class="layui-btn" lay-submit lay-filter="update" >修改</button>
						      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
						    </div>
						  	</div>
						</form>		
				    </div>
				</div>   
	<script type="text/html" id="barDemo" >
	  <a class="btn btn-info btn-xs" lay-event="inser"><i class="glyphicon glyphicon-plus"></i>新增</a>
	  <a class="btn btn-primary btn-xs" lay-event="edit"><i class="glyphicon glyphicon-edit"></i>编辑</a>
	  <a class="btn btn-danger btn-xs" lay-event="remove"> <i class="glyphicon glyphicon-remove"></i>删除</a>
	</script>
	<script src="js/jquery-1.12.4.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/vue.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/layui.js" type="text/javascript" charset="utf-8"></script>
	<script>
		layui.config({
				    base: 'js/'
			}).use(['treeTable',"layer","table","form"], function () {
				    var treeTable = layui.treeTable;
				    var layer=layui.layer;
				    var table=layui.table;
				    var form=layui.form;
					// 渲染表格
					var insTb = treeTable.render({
					    elem: '#test',
//					    data: data,  // 数据
					    url:'http://localhost:8888/SysClazzController/findAll',
		    			id: 'testReload',
					    method:"get",
					    treeSpid: '0',		//最上级的父级id
			            treeIdName: 'clazzId',	//id字段的名称
			            treePidName: 'parentId',	
					    parseData:function(res){
					    	console.log(res);
					    	digui(res);
					    	function digui(item){
					    		for(var i=0;i<item.length;i++){
						    		if(item[i].status=="0"){
						    			item[i].status="正常";
						    		}else{
						    			item[i].status="停用";
						    		}
						    		if(item[i].children.length>0){
						    			digui(item[i].children);
						    		}
						    	}
					    	}
					    	
					    	return{
					    		"code":0
					    		,"msg":"ok"
					    		,"data":res
					    	}
					    },
					    tree: {
					        iconIndex: 1,    // 折叠图标显示在第几列
					    },
					    cols:[[
					      {type:'radio'}		     
					      ,{field:'clazzName', title: '班级名称'}
					      ,{field:'orderNum', title: '排序'}
					      ,{field:'status', title: '状态'}
					      ,{field:'createTime', title: '创建时间'}
					      ,{field:'sign', title: '操作', toolbar: '#barDemo'}
					    ]]
					}); 
					var $ = layui.$, active = {
				    	reload: function(){
						    var clazzName = $('#clazzName').val();
						    var status=$("#status").val();
					      //执行重载
					      if(clazzName!=null||status!=null){
					      	
					      }
					      insTb.reload( {
					       	where: {
					        	clazzName:clazzName,
					    		status:status
					       	}	
					      });
		
				    }
				 };
				 layui.use(['form', 'layedit', 'laydate'], function(){
					  var form = layui.form
					  ,layer = layui.layer
					  ,layedit = layui.layedit
					  ,laydate = layui.laydate;
					  
					form.on('submit(formDemo2)', function(data){
						$.ajax({
							type:"post",
							url:"http://localhost:8888/SysClazzController/create",
							data:data.field,
							success:function(res){
								console.log(res);
								layer.confirm("新增成功!",function(){
									location.href=location.href;
								});
								
							}
						});
						return false;
					});
					
					form.on('submit(update)', function(data){
						$.ajax({
							type:"post",
							url:"http://localhost:8888/SysClazzController/update",
							data:data.field,
							success:function(res){
								layer.confirm("修改成功!",function(){
									location.href=location.href;
								});
							}
						});
							return false;
					});
				});  
				   $('#find').on('click', function(){
					    var type = $(this).data('type');
					    active[type] ? active[type].call(this) : '';
				  });
		  
				  var shuju={};
				   table.on('radio(demo)', function(obj){
				   	 var checkStatus = table.checkStatus('testReload')
		      		,data = checkStatus.data;
				   	if(data.length==0){
				   		$("#xg").addClass("disabled");
				   		$("#sc").addClass("disabled");
				  	}else if(data.length==1){
				  		$("#xg").removeClass("disabled");
				  		shuju=data[0];
				  		
				    		if(shuju.status=="正常"){
				    			shuju.status="0";
				    		}else{
				    			shuju.status="1";
				    		}
				    	
				  		$("#sc").removeClass("disabled");
				  	}else{
				  		$("#sc").removeClass("disabled");
				  		$("#xg").addClass("disabled");	
				  	}
			  
		  			});
		  			/*从这里开始*/
					
		
		  			$('.add').on('click', function(){
					    layer.open({
			      				title:['添加数据','color:#333333;background-color:#f8f8f8;'], 
								type: 1
								,area: ['800px', '716px']
						        ,shade: 0
						        ,maxmin: true
						        ,offset: "auto" //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
						        ,id: 'layerDemo1'+"auto" //防止重复弹出
		//				        ,btn: ['确定','关闭']
		//				        ,btnAlign: 'r' 
						        ,content:$("#popCreateTest").html()
						        ,shade: 0 //不显示遮罩
			      			});
			      			 form.val('example1',{
	      			 			"dictType":sessionStorage.getItem("dictType")
	      					 });
					});
		  			
		  			$("#xg").on('click', function(){
		  				layer.open({
			      				title:['修改数据','color:#333333;background-color:#f8f8f8;'], 
								type: 1
								,area: ['800px', '716px']
						        ,shade: 0
						        ,maxmin: true
						        ,offset: "auto" //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
						        ,id: 'layerDemo'+"auto" //防止重复弹出
						        ,content:$("#popUpdateTest").html()
		//				        ,btn: ['确定','关闭']
		//				        ,btnAlign: 'r' //按钮居中
						        ,shade: 0 //不显示遮罩
						        ,yes: function(){
						        	
						    
						        }
			      		});
			      		form.val('example',shuju);
			      			
				   });
						
					treeTable.on('tool(test)', function (obj) {
					    var data = obj.data;
					   		 if(data.status=="正常"){
					    			data.status="0";
					    		}else{
					    			data.status="1";
					    		}
					    if(obj.event === 'edit'){
					      layer.open({
				      				title:['修改数据','color:#333333;background-color:#f8f8f8;'], 
									type: 1
									,area: ['800px', '716px']
							        ,shade: 0
							        ,maxmin: true
							        ,offset: "auto" //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
							        ,id: 'layerDemo'+"auto" //防止重复弹出
							        ,content:$("#popUpdateTest").html()
			//				        ,btn: ['确定','关闭']
			//				        ,btnAlign: 'r' //按钮居中
							        ,shade: 0 //不显示遮罩
							        ,yes: function(){
							          layer.closeAll();
							        }
				      			});
				      			 form.val('example',data);
					    } else if(obj.event === 'remove'){
					      layer.confirm('真的删除行么', function(index){
					        obj.del();
					        layer.close(index);
					        $.ajax({
			                      url:"http://localhost:8888/SysClazzController/delete/"+data.clazzId,
			                      data:{},
			                      type:"delete",
			                      dataType:"json",
			                      success:function(data){
			                        console.log(data);
			                          layer.msg(data.msg);
							          layer.alert("删除成功");
			                      },
			                      error:function(data){
			                          $.messager.alert('错误',data.msg);
			                      }
			                  });
					      
					      });
					      
					    }else if(obj.event === 'inser'){
					    	var data1={"parentId":data.clazzId};
					    	layer.open({
			      				title:['添加数据','color:#333333;background-color:#f8f8f8;'], 
								type: 1
								,area: ['800px', '716px']
						        ,shade: 0
						        ,maxmin: true
						        ,offset: "auto" //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
						        ,id: 'layerDemo1'+"auto" //防止重复弹出
		//				        ,btn: ['确定','关闭']
		//				        ,btnAlign: 'r' 
						        ,content:$("#popCreateTest").html()
						        ,shade: 0 //不显示遮罩
			      			});
			      			
			      			 form.val('example1',data1);
					    }
					  });
					   
					
				var flag=true;
				$('#zhankai').click(function () {
		            if(flag){
		            	insTb.expandAll('#test');
		            	flag=false;
		            }else{
		            	insTb.foldAll('#test');
		            	flag=true;
		            }
		        });
				
		});
	layui.use('form',function(){
		  var $ = layui.jquery
		  var form = layui.form
			    $.ajax({
			        url: 'http://localhost:8888/SysDeptController/find',
			        dataType: 'json',
			        type: 'get',
			        success: function(data) {
			            if (data!== null) {
			            	$("#parentId").empty();
		                	$("#parentId").append(new Option("请选择所属年级", "0"));
			                $.each(data, function(index, item) {                   
			                    $('#parentId').append(new Option(item.deptName,item.deptId));
			                });
			                
			                $("#parentId2").empty();
		                	$("#parentId2").append(new Option("请选择所属年级", "0"));
			                $.each(data, function(index, item) {                   
			                    $('#parentId2').append(new Option(item.deptName,item.deptId));
			                });
			            } else {
			                $("#parentId").append(new Option("暂无数据", ""));
			                $("#parentId2").append(new Option("暂无数据", ""));
			            }
			            //重新渲染
			            form.render("select");
			        }
			    });
		});
  		//
		
  	
  	$(function(){
  			$("[name=showSearch]").click(function(){
  				$(".search-collapse").slideToggle();
  			});
  			$("[name=refresh]").click(function(){
  				location.reload();
  			});
  		});

	</script>	
</html>
