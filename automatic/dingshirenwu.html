<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>定时任务</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/style2.css"/>
		<link rel="stylesheet" type="text/css" href="css/layui.css"/>
	</head>
	<body class="gray-bg">
	<div class="container-div">
	    <div class="row" style="padding:0px;">
	        <div class="col-sm-12 search-collapse">
	            <form id="formId">
	                <div class="select-list">
	                    <ul class="list-inline">
	
	                        <li>
								任务名称：
	                            <input type="text"  id="jobName" value=""/>
	                        </li>
	
	                        <li>
	                           	方法名称：
	                            <input type="text"  id="methodName" value=""/>
	                        </li>
							
							 <li>
	                           	任务状态：
	                            <select id="status" name="status">
	                                <option value="全部">所有</option>
	                                <option value="0">正常</option>
	                                <option value="1">停止</option>
	                            </select>
	                        </li>
	                        
	                        <li>
	                            <a class="btn btn-primary btn-rounded btn-sm " id="find" data-type="reload"><i
	                                    class="fa fa-search glyphicon glyphicon-search"></i>&nbsp;搜索</a>
	                            <a class="btn btn-warning btn-rounded btn-sm"  onclick="resetForm()"><i
	                                    class="fa fa-refresh glyphicon glyphicon-refresh"></i>&nbsp;重置</a>
	                        </li>
	                    </ul>
	                </div>
	            </form>
	        </div>
	        
	        <div class="col-sm-12 select-table table-striped">
	        	<div class="btn-group-sm hidden-xs" id="toolbar" role="group"  style="margin-top: 14px;">
	                <a class="btn btn-info btn-del btn-del " onclick="$.operate.removeAll()" href="diaodurizhi.html">
	                    <i class=" glyphicon glyphicon-log-out"></i> 日志
	                </a>
					<div class="columns columns-right btn-group pull-right">
		        		<button class="btn btn-default btn-outline" type="button" name="showSearch" title="搜索">
		        			<i class="glyphicon glyphicon-search"></i>
		        		</button>
		        		<button class="btn btn-default btn-outline" type="button" name="refresh" title="刷新">
		        			<i class="glyphicon glyphicon-refresh icon-refresh"></i>
		        		</button>
		        		<button class="btn btn-default btn-outline" type="button" name="toggle" title="切换">
		        			<i class="glyphicon glyphicon-list-alt icon-list-alt"></i>
		        		</button>
		        			        		
					</div>
				</div>
		        <table class="layui-hide" id="test"></table>
	        </div>
	    </div>
	</div>
	
	<script src="js/jquery-1.12.4.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/vue.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/layui.js" type="text/javascript" charset="utf-8"></script>
	<script>
		 function resetForm() {
            $('#jobName').val("");
			    $("#methodName").val("");
			    $("#status").val("全部");
        }
		
		layui.use('table', function(){
		  var table = layui.table;
		  table.render({
		    elem: '#test'
		    ,url:"http://localhost:8888/sysJob/find"
		    ,cols: [[
		      {type:'checkbox'}
		      ,{field:'jobId', title: '任务编号'}
		      ,{field:'jobName', title: '任务名称',sort: true}
		      ,{field:'jobGroup', title: '任务组名',sort: true}
		      ,{field:'methodName', title: '方法名称'}
		      ,{field:'methodParams', title: '方法参数'}
		      ,{field:'cronExpression', title: '执行表达式'}
		      ,{field:'status', title: '任务状态'}
		      ,{field:'updateTime', title: '更新时间',sort: true}
		    ]]
		    ,page: { //分页设定
                layout: ['count', 'prev', 'page', 'next'] //自定义分页布局
                , curr: 1 //设定初始在第 1 页
                , limit: 10//每页多少数据
                , groups: 5 //只显示 5 个连续页码
           },parseData:function(res){
		    	for(var i=0;i<res.list.length;i++){
		    		if(res.list[i].status=="0"){
		    			res.list[i].status="正常";
		    		}else{
		    			res.list[i].status="停用";
		    		}
		    	}
		    	return{
		    		"code":0,
		    		"msg":"",
		    		"count":res.pages,
		    		data:res.list
		    	}
		    }
		    ,id: 'testReload' 
		  });
		  
		  var $ = layui.$, active = {
		    	reload: function(){
				   var jobName = $('#jobName').val();
				    var methodName=$("#methodName").val();
				    var status=$("#status").val();
			      //执行重载
			      table.reload('testReload', {
			        page: {
			          curr: 1 //重新从第 1 页开始
			        }
			        ,where: {
			        	jobName:jobName,
			        	methodName:methodName,
			        	status:status
			        }
			      });

		    }
		  };
		  	$('#find').on('click', function(){
			    var type = $(this).data('type');
			    active[type] ? active[type].call(this) : '';
		  });
		});
		$(function(){
  			$("[name=showSearch]").click(function(){
  				$(".search-collapse").slideToggle();
  			});
  			$("[name=refresh]").click(function(){
  				location.reload();
  			});
  		});
	</script>
</html>
