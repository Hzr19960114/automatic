<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>操作日志</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/style2.css"/>
		<link rel="stylesheet" type="text/css" href="css/layui.css"/>
	</head>
	<body class="gray-bg">
	<div class="container-div">
	    <div class="row" style="padding:0px;">
	        <div class="col-sm-12 search-collapse">
	            <form id="formId">
	                <div class="select-list">
	                    <input id="treeId" name="moduleId" type="hidden" value=""/>
	                    <ul class="list-inline">
	
	                        <li>
								模块标题：
	                            <input type="text"  id="title"  value=""/>
	                        </li>
	
	                        <li>
	                           	操作人员：
	                            <input type="text"  id="operName" value=""/>
	                        </li>
							
							 <li>
	                           	操作状态：
	                            <select id="status" name="status">
	                                <option value="2">所有</option>
	                                <option value="0">成功</option>
	                                <option value="1">失败</option>
	                            </select>
	                        </li>
	                        
	                        <li class="select-time">
								<label>执行时间： </label>
								<div class="layui-input-inline">
							        <input type="text" class="layui-input" id="test11" placeholder="开始时间">
								<span>-</span>
							    </div>
								<div class="layui-input-inline">
							        <input type="text" class="layui-input" id="test12" placeholder="结束时间">
							    </div>
							</li>
							
	                        <li>
	                            <a class="btn btn-primary btn-rounded btn-sm " id="find" data-type="reload"><i
	                                    class="fa fa-search glyphicon glyphicon-search"></i>&nbsp;搜索</a>
	                            <a class="btn btn-warning btn-rounded btn-sm" onclick="resetForm()"><i
	                                    class="fa fa-refresh glyphicon glyphicon-refresh"></i>&nbsp;重置</a>
	                        </li>
	                    </ul>
	                </div>
	            </form>
	        </div>
	        
	        <div class="col-sm-12 select-table table-striped">
	        	<div class="btn-group-sm hidden-xs" id="toolbar" role="group"  style="margin-top: 14px;">
	                <a class="btn btn-danger btn-del btn-del disabled" id="sc">
	                    <i class="glyphicon glyphicon-remove"></i> 删除
	                </a>
	                <a class="btn btn-danger" id="qk">
	                    <i class="glyphicon glyphicon-trash"></i> 清空
	                </a>
	                <a class="btn btn-warning" id="dc">
	                    <i class="glyphicon glyphicon-save"></i> 导出
	                </a>
					<div class="columns columns-right btn-group pull-right">
		        		<button class="btn btn-default btn-outline" type="button" name="showSearch" title="搜索">
		        			<i class="glyphicon glyphicon-search"></i>
		        		</button>
		        		<button class="btn btn-default btn-outline" type="button" name="refresh" title="刷新">
		        			<i class="glyphicon glyphicon-refresh icon-refresh"></i>
		        		</button>
		        		<button class="btn btn-default btn-outline" type="button" name="toggle" title="切换">
		        			<i class="glyphicon glyphicon-list-alt icon-list-alt"></i>
		        		</button>
		        			        		
					</div>
				</div>
		        <table class="layui-hide" id="test" lay-filter="demo"></table>
	        </div>
	        <div class="layui-row" id="popUpdateTest" style="display:none;">
			    <div class="layui-col-md10">
			    	<form class="form-horizontal m layui-form" id="form-menu-add" novalidate="novalidate" lay-filter="example">
					<input id="treeId" name="parentId" type="hidden" value="0">
					<div class="form-group">
						<label class="col-sm-3 control-label ">操作模块：</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="title" name="title" readonly="readonly">&nbsp;
							<input class="form-control" type="text" id="operatorType" name="operatorType" readonly="readonly">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">登录信息：</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="operName" name="operName" readonly="readonly">&nbsp;
							<input class="form-control" type="text" id="deptName" name="deptName" readonly="readonly">&nbsp;
							<input class="form-control" type="text" id="operIp" name="operIp" readonly="readonly">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">请求地址：</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" name="operUrl" id="operUrl" readonly="readonly">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">操作方法：</label>
						<div class="col-sm-8">
							<input id="method" name="method" class="form-control" type="text" readonly="readonly">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-3 control-label">请求参数：</label>
						<div class="col-sm-8">
							<input id="operParam" name="operParam" class="form-control" type="text" readonly="readonly">
						</div>
					</div>
				</form>
			    </div>
			</div>
	    </div>
	</div>
	<script type="text/html" id="barDemo">
	  <!--<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>-->
	  <a class="layui-btn layui-btn-xs" lay-event="edit">详情</a>
	</script>
	<script src="js/jquery-1.12.4.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/vue.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/layui.js" type="text/javascript" charset="utf-8"></script>
	<script>
		 function resetForm() {
            	$('#title').val("");
			    $("#operName").val("");
			    $("#status").val("2");
			    $("#test11").val("");
			    $("#test12").val("");
        }
		 
		layui.use('laydate', function(){
			var laydate = layui.laydate;
			laydate.render({
			    elem: '#test11'
			   ,type: 'date'
			});
			laydate.render({
			    elem: '#test12'
			   ,type: 'date'
			});
		});
		
		layui.use('table', function(){
		  var table = layui.table;
		  var tableIns=table.render({
		    elem: '#test'
		    ,url:"http://localhost:8888/operlog/find"
		    ,cols: [[
		      {type:'checkbox'}
		      ,{field:'operId', title: '日志编号'}
		      ,{field:'title', title: '模块标题',sort: true}
		      ,{field:'businessType', title: '业务类型',sort: true}
		      ,{field:'operatorType', title: '操作类别'}
		      ,{field:'operName', title: '操作人员'}
		      ,{field:'deptName', title: '部门名称'}
		      ,{field:'status', title: '操作状态'}
		      ,{field:'operTime', title: '操作时间',sort: true}
		      ,{field:'wealth3', title: '操作',toolbar: '#barDemo'}
		    ]]
		   ,page: { //分页设定
                layout: ['count', 'prev', 'page', 'next'] //自定义分页布局
                , curr: 1 //设定初始在第 1 页
                , limit: 10//每页多少数据
                , groups: 5 //只显示 5 个连续页码
           },parseData:function(res){
		    	for(var i=0;i<res.list.length;i++){
		    		if(res.list[i].status=="0"){
		    			res.list[i].status="成功";
		    		}else{
		    			res.list[i].status="失败";
		    		}
		    		
		    		if(res.list[i].businessType=="0"){
		    			res.list[i].businessType="其他";
		    		}else if(res.list[i].businessType=="1"){
		    			res.list[i].businessType="新增";
		    		}else if(res.list[i].businessType=="2"){
		    			res.list[i].businessType="修改";
		    		}else if(res.list[i].businessType=="3"){
		    			res.list[i].businessType="删除";
		    		}
		    		
		    		if(res.list[i].operatorType=="0"){
		    			res.list[i].operatorType="其他";
		    		}else if(res.list[i].operatorType=="1"){
		    			res.list[i].operatorType="后台用户";
		    		}else{
		    			res.list[i].operatorType="手机端用户";
		    		}
		    	}
		    	return{
		    		"code":0,
		    		"msg":"",
		    		"count":res.pages,
		    		data:res.list
		    	}
		    }
		    ,id: 'testReload' 
		  });
		  
		  var $ = layui.$, active = {
		    	reload: function(){
				   var title = $('#title').val();
				    var operName=$("#operName").val();
				    var status=$("#status").val();
				    var operTime=$("#test11").val();
			    	var updateTime=$("#test12").val();
			      //执行重载
			      table.reload('testReload', {
			        page: {
			          curr: 1 //重新从第 1 页开始
			        }
			        ,where: {
			        	title:title,
			        	operName:operName,
			        	status:status,
			        	operTime:operTime,
		        		updateTime:updateTime
			        }
			        ,method:"post"
			      });

		    }
		  };
		  	$('#find').on('click', function(){
			    var type = $(this).data('type');
			    active[type] ? active[type].call(this) : '';
		  });
		  
		   table.on('checkbox(demo)', function(obj){
		   	 var checkStatus = table.checkStatus('testReload')
      		,data = checkStatus.data;
		   	if(data.length==0){
		   		$("#sc").addClass("disabled");
		  	}else if(data.length==1){
		  		$("#sc").removeClass("disabled");
		  	}else{
		  		$("#sc").removeClass("disabled");
		  	}
	  
  			});
  			
  			$("#sc").on('click', function(){
		   		var checkStatus = table.checkStatus('testReload')
      			,data = checkStatus.data;
      			for(var i=0;i<data.length;i++){
	      			if(data[i].businessType=="其他"){
		    			data[i].businessType="0";
		    		}else if(data[i].businessType=="新增"){
		    			data[i].businessType="1";
		    		}else if(data[i].businessType=="修改"){
		    			data[i].businessType="2";
		    		}else if(data[i].businessType=="删除"){
		    			data[i].businessType="3";
		    		}
			    	if(data[i].operatorType=="其他"){
		    			data[i].operatorType="0";
		    		}else if(data[i].operatorType=="后台用户"){
		    			data[i].operatorType="1";
		    		}else{
		    			data[i].operatorType="2";
		    		}
		    		if(data[i].status=="成功"){
		    			data[i].status="0";
		    		}else{
		    			data[i].status="1";
		    		}
		    	}
      			var str=JSON.stringify(data);
      			console.log(data);
      			layer.confirm('确定要删除选中的'+data.length+'条数据吗？', function(index){
      				 layer.close(index);
      				 $.ajax({
      				 	url:"http://localhost:8888/operlog/removeList",
				      	method:"post",
						data:str,
						contentType:"application/json;charset=utf-8",
				      	success:function(res){
				      		 tableIns.reload();
				      		layer.alert("删除成功");
				      		$("#sc").addClass("disabled");
				      	}
      				 });
      			 });
      			
		   	});
		   	
		   	$("#qk").on('click', function(){
		   		layer.confirm('确定清空所有调度日志吗？', function(index){
		   			$.ajax({
		   				type:"get",
		   				url:"http://localhost:8888/operlog/removeFind",
		   				success:function(res){
				      		 tableIns.reload();
				      		layer.alert("清空成功");
				      	}
		   			});
		   		});	
		   	});	
		   	
		   	$("#dc").on('click',function(){
		   			var title = $('#title').val();
				    var operName=$("#operName").val();
				    var status=$("#status").val();
				    var operTime=$("#test11").val();
			    	var updateTime=$("#test12").val();
		   		var url="?title="+title+"&operName="+operName+"&status="+status+"&operTime="+operTime+"&updateTime"+updateTime;
		   		location.href="http://localhost:8888/operlog/exportExcel"+url;
		   	});
		   	
		   	
		});
		layui.use(['table','form'], function(){
			var form = layui.form;
		  	var table = layui.table;
		  	table.on('tool(demo)', function(obj){
			    var data = obj.data;
			    console.log(data);
			  	if(obj.event === 'edit'){
			  		layer.open({
			            type:1,
			            title:"查看日志详情",
			           	area: ['800px', '676px']
			           	,shade: 0
				        ,maxmin: true
				        ,content:$("#popUpdateTest").html()
				        ,btn: ['确定','关闭']
				        ,btnAlign: 'r' 
				        ,shade: 0 
				        ,yes: function(){
				          layer.closeAll();
				        }
				  	});
			      form.val('example',data);
			    }
			});
		});
		$(function(){
  			$("[name=showSearch]").click(function(){
  				$(".search-collapse").slideToggle();
  			});
  			$("[name=refresh]").click(function(){
  				location.reload();
  			});
  		});
	</script>	
</html>
