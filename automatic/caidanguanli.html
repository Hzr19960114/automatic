<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>菜单管理</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/style2.css"/>
		<link rel="stylesheet" type="text/css" href="css/layui.css"/>
	</head>
	<body class="gray-bg">
	<div class="container-div">
	    <div class="row" style="padding:0px;">
	        <div class="col-sm-12 search-collapse">
	            <form id="formId">
	                <div class="select-list">
	                    <input id="treeId" name="moduleId" type="hidden" value=""/>
	                    <ul class="list-inline">
	
	                        <li>
								菜单名称：
	                            <input type="text"  id="menuName" value=""  name="menuName"/>
	                        </li>
							
							<li>
	                           	菜单状态：
	                            <select id="visible" name="visible">
	                                <option value="2">所有</option>
	                                <option value="0">显示</option>
	                                <option value="1">隐藏</option>
	                            </select>
	                       </li>
							
	                        <li>
	                            <a class="btn btn-primary btn-rounded btn-sm " id="find" data-type="reload"><i
	                                    class="fa fa-search glyphicon glyphicon-search"></i>&nbsp;搜索</a>
	                            <a class="btn btn-warning btn-rounded btn-sm" onclick="resetForm()"><i
	                                    class="fa fa-refresh glyphicon glyphicon-refresh"></i>&nbsp;重置</a>
	                        </li>
	                    </ul>
	                </div>
	            </form>
	        </div>
	        
	        <div class="col-sm-12 select-table table-striped">
	        	<div class="btn-group-sm hidden-xs" id="toolbar" role="group"  style="margin-top: 14px;">
	                <a class="btn btn-primary add"data-method="offset" data-type="auto">
	                    <i class="glyphicon glyphicon-plus"></i> 新增
	                </a>
	                <a class="btn btn-success btn-edit disabled" data-method="offset" data-type="auto" id="xg"> 
	                    <i class="glyphicon glyphicon-edit"></i> 修改
	                </a>
	                 <a class="btn btn-info" data-method="offset" data-type="auto" id="zhankai">
	                    <i class="glyphicon glyphicon-sort"></i> 展开/折叠
	                </a>
					<div class="columns columns-right btn-group pull-right">

		        		<button class="btn btn-default btn-outline" type="button" name="refresh" title="刷新">
		        			<i class="glyphicon glyphicon-refresh icon-refresh"></i>
		        		</button>
						<button type="button" aria-label="columns" class="btn btn-default btn-outline dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
							<i class="glyphicon glyphicon-list"></i>
							<span class="caret"></span>
						</button>
						<ul class="dropdown-menu columns" role="menu">
							<li role="menuitem"><label><input type="checkbox" checked="checked" data-field="menuName" value="menuName"> 菜单名称</label></li>
							<li role="menuitem"><label><input type="checkbox" checked="checked" data-field="orderNum" value="orderNum"> 排序</label></li>
							<li role="menuitem"><label><input type="checkbox" checked="checked" data-field="url" value="url"> 请求地址</label></li>
							<li role="menuitem"><label><input type="checkbox" checked="checked" data-field="menuType" value="menuType"> 类型</label></li>
							<li role="menuitem"><label><input type="checkbox" checked="checked" data-field="visible" value="visible"> 可见</label></li>
							<li role="menuitem"><label><input type="checkbox" checked="checked" data-field="perms" value="perms"> 权限标识</label></li>
							<li role="menuitem"><label><input type="checkbox" checked="checked" data-field="undefined" value="undefined"> 操作</label></li>
						</ul>					
					</div>
				</div>
				
		        <table class="layui-hide" id="test" lay-filter="demo"></table>
		        
		        <div class="layui-row" id="popCreateTest" style="display:none;">
				    <div class="layui-col-md10">
				    	<form class="form-horizontal m layui-form" id="form-menu-add" novalidate="novalidate" lay-filter="example1">
						<input id="treeId" name="parentId" type="hidden" value="0">
						<div class="form-group">
							<label class="col-sm-3 control-label ">上级菜单：</label>
							<div class="col-sm-8">
								<select name="parentId" id="parentId">
									<option value=""></option>
								</select>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">菜单类型：</label>
							<div class="col-sm-8">
								<input type="radio" name="menuType" value="M" checked="" title="目录" >
								<input type="radio" name="menuType" value="C"  title="菜单" >
								<input type="radio" name="menuType" value="F" title="按钮" >
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">菜单名称：</label>
							<div class="col-sm-8">
								<input class="form-control" type="text" name="menuName" id="menuName">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">请求地址：</label>
							<div class="col-sm-8">
								<input id="url" name="url" class="form-control" type="text">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">权限标识：</label>
							<div class="col-sm-8">
								<input id="perms" name="perms" class="form-control" type="text">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">显示排序：</label>
							<div class="col-sm-8">
								<input class="form-control"  type="text" name="orderNum">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">图标：</label>
							<div class="col-sm-8">
								<input id="icon" name="icon" class="form-control" type="text" placeholder="选择图标">
			                    <div class="ms-parent" style="width: 100%;">
			                        <div class="icon-drop animated flipInX" style="max-height: 200px; overflow-y: auto;">
			                            <div>
											<iframe src="tubiao.html" style="width: 100%;border: 0px;"></iframe>
										</div>
			                        </div>
			                    </div>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">菜单状态：</label>
							<div class="col-sm-8">
								<input type="radio" id="4" name="visible" value="0" checked="checked"  title="显示">	
								<input type="radio" id="5" name="visible" value="1"  title="隐藏">				
							</div>
						</div>
						<div class="layui-form-item">
						    <div class="layui-input-block" style="text-align: center;">
						    	 <button class="layui-btn" lay-submit lay-filter="formDemo2" >新增</button>
						      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
						    </div>
						</div>
					</form>
				    </div>
				</div>
				
				<div class="layui-row" id="popUpdateTest" style="display:none;">
				    <div class="layui-col-md10">
				    	<form class="form-horizontal m layui-form" id="form-menu-add" novalidate="novalidate" lay-filter="example">
						<input id="treeId" name="parentId" type="hidden" value="0">
						<div class="form-group">
							<label class="col-sm-3 control-label ">上级菜单：</label>
							<div class="col-sm-8">
								<input class="form-control" type="text" id="treeName" name="treeName">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">菜单类型：</label>
							<div class="col-sm-8">
								<input type="radio" name="menuType" value="M" checked="" title="目录">
								<input type="radio" name="menuType" value="C"  title="菜单">
								<input type="radio" name="menuType" value="F" title="按钮">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">菜单名称：</label>
							<div class="col-sm-8">
								<input class="form-control" type="text" name="menuName" id="menuName">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">请求地址：</label>
							<div class="col-sm-8">
								<input id="url" name="url" class="form-control" type="text">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">权限标识：</label>
							<div class="col-sm-8">
								<input id="perms" name="perms" class="form-control" type="text">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">显示排序：</label>
							<div class="col-sm-8">
								<input class="form-control"  type="text" name="orderNum">
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">图标：</label>
							<div class="col-sm-8">
								<input id="icon" name="icon" class="form-control" type="text" placeholder="选择图标">
			                    <div class="ms-parent" style="width: 100%;">
			                        <div class="icon-drop animated flipInX" style="max-height: 200px; overflow-y: auto;">
			                            <div>
											<iframe src="tubiao.html" style="width: 100%;border: 0px;"></iframe>
										</div>
			                        </div>
			                    </div>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-3 control-label">菜单状态：</label>
							<div class="col-sm-8">
								<input type="radio" id="4" name="visible" value="0" checked="checked"  title="显示">	
								<input type="radio" id="5" name="visible" value="1"  title="隐藏">				
							</div>
						</div>
						<div class="layui-form-item">
						    <div class="layui-input-block" style="text-align: center;">
						    	 <button class="layui-btn" lay-submit lay-filter="update" >修改</button>
						      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
						    </div>
						</div>
					</form>
				    </div>
				</div>
	        </div>
	    </div>
	</div>
	<script type="text/html" id="barDemo" >
		<a class="btn btn-primary btn-xs" lay-event="edit"><i class="glyphicon glyphicon-edit"></i>编辑</a>
	  	<a class="btn btn-danger btn-xs" lay-event="remove"> <i class="glyphicon glyphicon-remove"></i>删除</a>
	</script>
	<script src="js/jquery-1.12.4.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/vue.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/layui.js" type="text/javascript" charset="utf-8"></script>
	<script>
		function resetForm() {
       		$('#menuName').val("");
		    $("#visible").val("2");
        }
		layui.use(['form', 'layedit', 'laydate'], function(){
			  var form = layui.form
			  ,layer = layui.layer
			  ,layedit = layui.layedit
			  ,laydate = layui.laydate;
			form.on('submit(formDemo2)', function(data){
				$.ajax({
					type:"post",
					url:"http://localhost:8888/menu/create",
					data:data.field,
					success:function(res){
						layer.confirm("新增成功!",function(){
							location.href=location.href;
						});
					}
				});
				return false;
			});
			
			form.on('submit(update)', function(data){
				$.ajax({
					type:"post",
					url:"http://localhost:8888/menu/update",
					data:data.field,
					success:function(res){
						layer.confirm("修改成功!",function(){
							location.href=location.href;
						});
					}
				});
					return false;
			});
		});  
		
		layui.config({
				    base: 'js/'
			}).use(['treeTable',"layer","table","form"], function () {
		  			var form = layui.form;
				    var treeTable = layui.treeTable;
				    var layer=layui.layer;
				    var table=layui.table;
					// 渲染表格
					var insTb = treeTable.render({
					    elem: '#test',
//					    data: data,  // 数据
					    url:'http://localhost:8888/menu/findById',
					    method:"get",
					    treeSpid: '0',		//最上级的父级id
			            treeIdName: 'menuId',	//id字段的名称
			            treePidName: 'parentId',	
					    tree: {
					        iconIndex: 1,    // 折叠图标显示在第几列
					    },
					    cols:[[
					      {type:'radio'}
					      ,{field:'menuName', title: '菜单名称'}
					      ,{field:'orderNum', title: '排序',sort: true}
					      ,{field:'url', title: '请求地址'}
						  ,{field:'menuType', title: '类型',width:70,align:'middle'}
					      ,{field:'visible', title: '可见',width:70,align:'middle'}
					      ,{field:'perms', title: '权限标识'}
					      ,{align: 'center', toolbar: '#barDemo', title: '操作'}
					    ]]
					    ,parseData:function(res){
					    	return{
					    		"code":0
					    		,"msg":"ok"
					    		,"data":res
					    	}
					    }
					    ,done: function(res, curr, count){
							$("[data-field='visible']").children().each(function(){
							     if($(this).text()==0){
							      $(this).text("显示")
							     }else if($(this).text()==1){
							      $(this).text("隐藏")
							     }
							})
							$("[data-field='menuType']").children().each(function(){
							     if($(this).text()=='M'){
							      $(this).text("目录")
							     }else if($(this).text()=='C'){
							      $(this).text("菜单")
							     }else if($(this).text()=='F'){
							      $(this).text("按钮")
							     }
							});
						}
					    ,id: 'testReload'
					});
					var $ = layui.$, active = {
				    	reload: function(){
						   	var menuName = $('#menuName').val();
						    var visible=$("#visible").val();
					      	//执行重载
					      	insTb.reload({
						        where: {
						        	menuName:menuName,
						        	visible:visible,
						        }
							});
						}
					};
					$('#find').on('click', function(){
					    var type = $(this).data('type');
					    active[type] ? active[type].call(this) : '';
				 	});
				 	var shuju={};
				 	table.on('radio(demo)', function(obj){
					   	 var radio = table.radio('testReload')
			      		,data = radio.data;
					   	if(data.checked=="checked"){
					   		$("#xg").addClass("disabled");
					  	}else{
					  		$("#xg").removeClass("disabled");
					  		shuju=data[0];
					  	}
				  	});
					treeTable.on('tool(test)', function (obj) {
					    var data = obj.data;
					    if(obj.event === 'edit'){
					     	layer.open({
					            type:1,
					            title:"修改用户信息",
					           	area: ['800px', '676px']
					           	,shade: 0
						        ,maxmin: true
						        ,content:$("#popUpdateTest").html()
//							        ,btn: ['确定','关闭']
						        ,btnAlign: 'r' 
						        ,shade: 0 
						        ,yes: function(){
						          layer.closeAll();
						        }
					  		});
					    } else if(obj.event === 'remove'){
					      layer.confirm('真的删除行么', function(index){
					        layer.close(index);
						      $.ajax({
						      	url:"http://localhost:8888/menu/remove",
						      	data:{
						      		menuId:data.menuId
						      	},
						      	success:function(res){
						      		layer.alert(res);
						      		if(res=="删除成功！"){
					        			obj.del();
						      		}
						      	}
						      });
					      
					      });
					    }
					});
					
		var flag=true;
		$('#zhankai').click(function () {
            if(flag){
            	insTb.expandAll('#test');
            	flag=false;
            }else{
            	insTb.foldAll('#test');
            	flag=true;
            }
        });
			
		});
		
		layui.use(['layer','form'], function(){ //独立版的layer无需执行这一句
			var form=layui.form;
			var active = {
				offset: function(othis){
      				var type = othis.data('type');
	      			layer.open({
	      				title:['添加菜单','color:#333333;background-color:#f8f8f8;'], 
						type: 1
						,area: ['800px', '676px']
				        ,shade: 0
				        ,maxmin: true
				        ,offset: type //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
				        ,id: 'layerDemo'+type //防止重复弹出
				        ,content:$("#popCreateTest").html()
				        ,btnAlign: 'r' 
				        ,shade: 0 
				        ,yes: function(){
				        	layer.closeAll();
				        }
	      			});
    			}
			}
			$('.add').on('click', function(){
			    var othis = $(this), method = othis.data('method');
			    active[method] ? active[method].call(this, othis) : '';
			    form.val('example1',{});
			});
  	});
  	
  	layui.use('form',function(){
		var $ = layui.jquery
		var form = layui.form
		    $.ajax({
		        url: 'http://localhost:8888/menu/findByType',
		        dataType: 'json',
		        type: 'get',
		        success: function(data) {
		            if (data!== null) {
		            	$("#parentId").empty();
	                	$("#parentId").append(new Option("请选择上级部门", "0"));
		                $.each(data, function(index, item) {                   
		                    $('#parentId').append(new Option(item.menuName,item.menuId));
		                });
		            } else {
		                $("#parentId").append(new Option("暂无数据", ""));
		            }
		            //重新渲染
		            form.render("select");
		        }
		    });
	});
  	$(function(){
  			$("[name=showSearch]").click(function(){
  				$(".search-collapse").slideToggle();
  			});
  			$("[name=refresh]").click(function(){
  				location.reload();
  			});
  		});
	</script>	
</html>
